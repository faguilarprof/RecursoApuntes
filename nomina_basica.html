<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Introducci√≥n a los conceptos b√°sicos de una n√≥mina</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  body{font-family:Arial,Helvetica,sans-serif;background:#f4f7fa;margin:0;padding:2rem;color:#333}
  h1{text-align:center;color:#005a9c}
  .step{display:none;background:#fff;border:1px solid #ddd;border-radius:8px;padding:1.5rem;margin:1rem auto;max-width:720px;box-shadow:0 2px 6px rgba(0,0,0,.1)}
  .step.active{display:block}
  button{background:#005a9c;color:#fff;border:none;padding:.6rem 1.2rem;border-radius:4px;cursor:pointer;margin-top:1rem}
  button:hover{background:#004070}
  .campo{margin:.4rem 0}
  label{display:inline-block;width:180px;font-weight:bold}
  input[readonly],select{background:#eef}
  input[type=number]{width:120px;padding:.3rem}
  .resumen{background:#e8f4fd;padding:1rem;border-left:4px solid #005a9c;margin-top:1rem}
  .mini-test{background:#fff3cd;padding:1rem;border-radius:6px;margin-top:1rem}
  .mini-test h4{margin-top:0}
  .opcion{display:block;margin:.3rem 0}
  .nav-buttons{display:flex;justify-content:space-between;margin-top:1rem}
  .pagas-extras-section {background:#f0f8ff;padding:1rem;border-radius:6px;margin:1rem 0;border:1px solid #d0e3ff}
  .concepto-pagas {margin-left:20px;margin-top:10px}
  .concepto-pagas label {width:auto;margin-right:10px}
  .info-box {background:#e8f4fd;padding:0.8rem;border-radius:4px;margin:0.5rem 0;font-size:0.9em}
  .mes-paga-extra {background:#fff3cd;padding:0.3rem 0.6rem;border-radius:4px;border:1px solid #ffc107;display:inline-block;margin-left:10px}
  .paga-extra-cobrada {background:#d4edda;color:#155724;padding:0.3rem 0.6rem;border-radius:4px;border:1px solid #c3e6cb;display:inline-block;margin-left:10px}
  .deduccion-explicacion {font-size:0.85em;color:#666;margin-left:20px;margin-top:2px}
  .deduccion-item {margin-bottom:8px;}
  .base-info {background:#f8f9fa;padding:10px;border-radius:4px;margin:10px 0;border-left:3px solid #6c757d;}
  .base-info h4 {margin-top:0;margin-bottom:5px;color:#495057;}

  /* ---------- CALCULADORA ---------- */
  .calcBtn{
    background:#444;
    color:white;
    padding:6px 12px;
    border:none;
    border-radius:6px;
    cursor:pointer;
    margin-bottom:15px;
  }
  .calcBtn:hover{background:#222}
</style>
</head>
<body>

<h1>Introducci√≥n a los conceptos b√°sicos de una n√≥mina</h1>

<!-- PASO 1: ENCABEZADO -->
<div class="step active" id="step1">
  <h2>1. Encabezado: qui√©n, d√≥nde, cu√°ndo y c√≥mo cotiza</h2>

  <div class="campo">
    <label>Empresa:</label>
    <input id="empresa" value="Confecciones Rodr√≠guez S.L." readonly>
  </div>
  <div class="campo">
    <label>CIF:</label>
    <input id="cif" value="B12345678" readonly>
  </div>
  <div class="campo">
    <label>Domicilio fiscal:</label>
    <input id="domicilio" value="Zaragoza" readonly>
  </div>
  <div class="campo">
    <label>CCC (Seg. Social):</label>
    <input id="ccc" value="50123456789" readonly>
  </div>
  <div class="campo">
    <label>CNAE:</label>
    <input id="cnae" value="1411 - Confecci√≥n de prendas de vestir de cuero" readonly>
  </div>
  <div class="campo">
    <label>Trabajador:</label>
    <input id="trabajador" value="Ana Garc√≠a P√©rez" readonly>
  </div>
  <div class="campo">
    <label>NIF:</label>
    <input id="nif" value="12345678Z" readonly>
  </div>
  <div class="campo">
    <label>NAF:</label>
    <input id="naf" value="501234567890" readonly>
  </div>
  <div class="campo">
    <label>Puesto de trabajo:</label>
    <input id="puesto" value="Confeccionista de cuero" readonly>
  </div>
  <div class="campo">
    <label>Grupo cotizaci√≥n:</label>
    <select id="grupo"><option value="2">2</option></select> (1-11)
    <small style="color:#666;">(Grupo 2: Oficiales administrativos)</small>
  </div>
  <div class="campo">
    <label>Periodo liquidaci√≥n:</label>
    <input type="month" id="periodo" value="2025-12" onchange="recalcTodo()">
    <span id="indicadorMes" style="margin-left:10px;"></span>
  </div>
  <div class="info-box">
    <strong>üí° Informaci√≥n importante:</strong>
    <p>La empresa tiene actividad de <strong>CNAE 1411</strong> (Confecci√≥n de prendas de vestir de cuero), 
    lo que implica una cotizaci√≥n por AT/EP del <strong>2,6%</strong> en contingencias profesionales.</p>
  </div>
  <button onclick="nextStep(2)">Siguiente ‚Üí</button>
</div>

<!-- PASO 2: DEVENGOS (EDITABLES) CON PAGAS EXTRAS -->
<div class="step" id="step2">
  <h2>2. Devengos: lo que se ¬´gana¬ª (¬°Juega con los valores!)</h2>

  <button class="calcBtn" onclick="toggleCalc()">üìü Calculadora</button>

  <div class="campo">
    <label>Salario base:</label>
    <input type="number" id="salBase" value="1000" min="0" step="50" oninput="recalcTodo()"> ‚Ç¨
  </div>
  <div class="campo">
    <label>Plus convenio:</label>
    <input type="number" id="plus" value="200" min="0" step="50" oninput="recalcTodo()"> ‚Ç¨
  </div>

  <!-- SECCI√ìN DE PAGAS EXTRAS -->
  <div class="pagas-extras-section">
    <h3 style="margin-top:0;color:#005a9c;">üí∞ Pagas extras</h3>
    <div class="campo">
      <label>N√∫mero de pagas extras anuales:</label>
      <select id="numPagas" onchange="actualizarMesesPagas(); recalcTodo()">
        <option value="0">0</option>
        <option value="2" selected>2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
      </select>
      <span id="infoPagasExtras" style="margin-left:10px;color:#666;"></span>
    </div>
    
    <!-- MESES DE PAGAS EXTRAS -->
    <div id="mesesPagasContainer" style="margin-top:10px;">
      <p><strong>Meses en que se cobran las pagas extras:</strong></p>
      <div id="mesesPagasSelect"></div>
    </div>
    
    <div id="conceptoPagasDiv" style="display:block;">
      <p><strong>Conceptos que integran las pagas extras:</strong></p>
      <div class="concepto-pagas">
        <label>
          <input type="radio" name="conceptoPagas" value="salarioBase" checked onchange="recalcTodo()">
          Solo salario base
        </label><br>
        <label>
          <input type="radio" name="conceptoPagas" value="salarioBasePlus" onchange="recalcTodo()">
          Salario base + plus convenio
        </label>
      </div>
    </div>
    
    <!-- INDICADOR SI ES MES DE PAGA EXTRA -->
    <div id="pagaExtraActualInfo" style="margin-top:10px;">
      <div class="paga-extra-cobrada">
        <strong>üìÖ Este mes se cobra paga extra:</strong> <span id="importePagaExtraActual">1.200,00</span> ‚Ç¨
      </div>
    </div>
    
    <div id="importePagasInfo" class="info-box">
      <strong>Prorrata mensual de pagas extras:</strong> <span id="prorrataPagas">200,00</span> ‚Ç¨<br>
      <small>(Se suma SIEMPRE a las bases de cotizaci√≥n, independientemente del mes)</small>
    </div>
  </div>

  <div class="campo">
    <label>Horas extra:</label>
    <input type="number" id="hex" value="150" min="0" step="50" oninput="recalcTodo()"> ‚Ç¨
  </div>
  <div class="campo">
    <label>Dietas <small>(cantidad justificada con factura)</small>:</label>
    <input type="number" id="dieta" value="60" min="0" step="10" oninput="recalcTodo()"> ‚Ç¨
  </div>
  
  <div id="resumenDevengosExtra" style="margin-top:15px; padding:10px; background:#f8f9fa; border-radius:4px;">
    <p><strong>Devengos totales este mes:</strong> <span id="totDev">2.610,00 ‚Ç¨</span></p>
    <p><small>Incluye: Salario base + plus + horas extra + dietas + (paga extra si corresponde)</small></p>
  </div>

  <div class="mini-test">
    <h4>ü§î Mini-reto</h4>
    <p>¬øCu√°nto del Total Devengado es <strong>salarial</strong>? </p>
    <div id="opcionesReto"></div>
    <button onclick="checkDev()">Comprobar</button>
    <span id="devOk"></span>
  </div>

  <div class="nav-buttons">
    <button onclick="nextStep(1)">‚Üê Paso anterior</button>
    <button onclick="nextStep(3)">Siguiente ‚Üí</button>
  </div>
</div>

<!-- PASO 3: DEDUCCIONES CON NUEVAS BASES DE COTIZACI√ìN -->
<div class="step" id="step3">
  <h2>3. Deducciones: lo que se ¬´descuenta¬ª de la n√≥mina</h2>

  <button class="calcBtn" onclick="toggleCalc()">üìü Calculadora</button>
  
  <div class="info-box">
    <h4 style="margin-top:0;">üìä Bases de cotizaci√≥n</h4>
    <div class="base-info">
      <p><strong>Base de contingencias comunes:</strong> <span id="baseCC">1.400,00</span> ‚Ç¨</p>
      <p><small>Salario base + plus convenio + prorrata mensual (SIEMPRE)</small></p>
      <p><small><strong>Se usa para:</strong> Contingencias comunes, MEI</small></p>
    </div>
    <div class="base-info">
      <p><strong>Base de contingencias profesionales:</strong> <span id="baseCP">1.550,00</span> ‚Ç¨</p>
      <p><small>Base CC + horas extra</small></p>
      <p><small><strong>Se usa para:</strong> Desempleo, FP, FOGASA, AT/EP</small></p>
    </div>
    <div class="base-info">
      <p><strong>Base de horas extra:</strong> <span id="baseHE">150,00</span> ‚Ç¨</p>
      <p><small>Importe de horas extra realizadas</small></p>
      <p><small><strong>Se usa para:</strong> Cotizaci√≥n horas extra</small></p>
    </div>
    <div class="base-info">
      <p><strong>Base para IRPF (retenci√≥n):</strong> <span id="baseIRPF">2.550,00</span> ‚Ç¨</p>
      <p><small>Salario base + plus + horas extra + (paga extra COMPLETA si corresponde)</small></p>
      <p><small><strong>IMPORTANTE:</strong> NO incluye prorrata NI dietas justificadas, pero S√ç incluye paga extra completa si se cobra</small></p>
    </div>
  </div>

  <h3>Deducciones del trabajador</h3>
  
  <!-- SECCI√ìN 1: SOBRE BASE DE CONTINGENCIAS COMUNES -->
  <div class="info-box" style="background:#e8f4fd; margin:15px 0;">
    <h4 style="margin-top:0;">üìã Sobre Base de Contingencias Comunes (<span id="baseCCVal">1.400,00</span> ‚Ç¨)</h4>
    
    <div class="deduccion-item">
      <div class="campo">
        <label>Contingencias comunes (4,70 %):</label>
        <input id="cc" value="65,80" readonly> ‚Ç¨
      </div>
      <div class="deduccion-explicacion">4,70% √ó <span id="baseCCValCC">1.400,00</span> ‚Ç¨</div>
    </div>
    
    <div class="deduccion-item">
      <div class="campo">
        <label>MEI (0,13 %):</label>
        <input id="mei" value="1,82" readonly> ‚Ç¨
      </div>
      <div class="deduccion-explicacion">0,13% √ó <span id="baseCCValMEI">1.400,00</span> ‚Ç¨</div>
    </div>
  </div>
  
  <!-- SECCI√ìN 2: SOBRE BASE DE CONTINGENCIAS PROFESIONALES -->
  <div class="info-box" style="background:#e8f5e8; margin:15px 0;">
    <h4 style="margin-top:0;">üìã Sobre Base de Contingencias Profesionales (<span id="baseCPVal">1.550,00</span> ‚Ç¨)</h4>
    
    <div class="deduccion-item">
      <div class="campo">
        <label>Desempleo (1,55 %):</label>
        <input id="paro" value="24,03" readonly> ‚Ç¨
      </div>
      <div class="deduccion-explicacion">1,55% √ó <span id="baseCPValParo">1.550,00</span> ‚Ç¨</div>
    </div>
    
    <div class="deduccion-item">
      <div class="campo">
        <label>FP (0,10 %):</label>
        <input id="fp" value="1,55" readonly> ‚Ç¨
      </div>
      <div class="deduccion-explicacion">0,10% √ó <span id="baseCPValFP">1.550,00</span> ‚Ç¨</div>
    </div>
  </div>
  
  <!-- SECCI√ìN 3: SOBRE BASE DE HORAS EXTRA -->
  <div class="info-box" style="background:#fff3cd; margin:15px 0;">
    <h4 style="margin-top:0;">üìã Sobre Base de Horas Extra (<span id="baseHEVal">150,00</span> ‚Ç¨)</h4>
    
    <div class="deduccion-item">
      <div class="campo">
        <label>Horas extra (4,70 %):</label>
        <input id="hexDed" value="7,05" readonly> ‚Ç¨
      </div>
      <div class="deduccion-explicacion">4,70% √ó <span id="baseHEValHex">150,00</span> ‚Ç¨</div>
    </div>
  </div>
  
  <!-- SECCI√ìN 4: IRPF (SOBRE BASE DE RETENCI√ìN) -->
  <div class="info-box" style="background:#f0e6fa; margin:15px 0;">
    <h4 style="margin-top:0;">üí∞ Retenci√≥n IRPF (sobre base de retenci√≥n)</h4>
    <p><strong>Base para IRPF:</strong> <span id="baseIRPFVal">2.550,00</span> ‚Ç¨</p>
    <p><small>Salario base + plus + horas extra + (paga extra COMPLETA si corresponde)</small></p>
    <p><small><strong>NOTA:</strong> Dietas justificadas NO computan en base IRPF</small></p>
    
    <div class="deduccion-item">
      <div class="campo">
        <label>IRPF (retenci√≥n 11 %):</label>
        <input id="irpf" value="280,50" readonly> ‚Ç¨
      </div>
      <div class="deduccion-explicacion">11% √ó <span id="baseIRPFValCalc">2.550,00</span> ‚Ç¨</div>
    </div>
  </div>
  
  <!-- SECCI√ìN 5: OTRAS DEDUCCIONES -->
  <div class="info-box" style="background:#f8f9fa; margin:15px 0;">
    <h4 style="margin-top:0;">üìù Otras deducciones</h4>
    
    <div class="campo">
      <label>Anticipo:</label>
      <input type="number" id="ant" value="100" min="0" step="50" oninput="recalcTodo()"> ‚Ç¨
    </div>
  </div>
  
  <div class="info-box" style="margin-top:20px; background:#d4edda; border-left-color:#28a745;">
    <p><strong>Total a Deducir: <span id="totalDed">480,75 ‚Ç¨</span></strong></p>
    <p><small>Suma de todas las deducciones anteriores</small></p>
  </div>

  <div class="nav-buttons">
    <button onclick="nextStep(2)">‚Üê Paso anterior</button>
    <button onclick="nextStep(4)">Siguiente ‚Üí</button>
  </div>
</div>

<!-- PASO 4: L√çQUIDO Y CUOTA PATRONAL -->
<div class="step" id="step4">
  <h2>4. Resultado final: lo que cobra el trabajador y lo que paga la empresa</h2>

  <button class="calcBtn" onclick="toggleCalc()">üìü Calculadora</button>

  <div class="resumen" style="border-left-color:#28a745;background:#e9f9ee;">
    <h3 style="margin-top:0;color:#1e7e34;">üí∞ L√≠quido a percibir (trabajador)</h3>
    <p><strong>L√≠quido = Devengos (<span id="txtDev">2.610,00 ‚Ç¨</span>) ‚Äì Deducciones (<span id="txtDed">480,75 ‚Ç¨</span>) = <span id="liq">2.129,25 ‚Ç¨</span></strong></p>
  </div>

  <hr style="margin:2rem 0;border:0;border-top:2px dashed #bbb">

  <div class="resumen" style="border-left-color:#c92a2a;background:#fdf0f0;">
    <h3 style="margin-top:0;color:#b21818;">üè¢ Cuota patronal (coste para la empresa)</h3>
    
    <!-- SECCI√ìN 1: SOBRE BASE DE CONTINGENCIAS COMUNES -->
    <div class="info-box" style="background:#e8f4fd; margin:15px 0;">
      <h4 style="margin-top:0;">üìã Sobre Base de Contingencias Comunes (<span id="patBaseCC">1.400,00</span> ‚Ç¨)</h4>
      <ul>
        <li>Contingencias comunes (23,60 %): <span id="ccPat">330,40</span> ‚Ç¨</li>
        <li>MEI (0,67 %): <span id="meiPat">9,38</span> ‚Ç¨</li>
      </ul>
    </div>
    
    <!-- SECCI√ìN 2: SOBRE BASE DE CONTINGENCIAS PROFESIONALES -->
    <div class="info-box" style="background:#e8f5e8; margin:15px 0;">
      <h4 style="margin-top:0;">üìã Sobre Base de Contingencias Profesionales (<span id="patBaseCP">1.550,00</span> ‚Ç¨)</h4>
      <ul>
        <li>Desempleo (5,50 %): <span id="paroPat">85,25</span> ‚Ç¨</li>
        <li>FP (0,60 %): <span id="fpPat">9,30</span> ‚Ç¨</li>
        <li>FOGASA (0,20 %): <span id="fogasaPat">3,10</span> ‚Ç¨</li>
        <li>Contingencias profesionales (2,60 %): <span id="atPat">40,30</span> ‚Ç¨
          <small style="color:#666;margin-left:5px;">(Tipo espec√≠fico para CNAE 1411)</small>
        </li>
      </ul>
    </div>
    
    <!-- SECCI√ìN 3: SOBRE BASE DE HORAS EXTRA -->
    <div class="info-box" style="background:#fff3cd; margin:15px 0;">
      <h4 style="margin-top:0;">üìã Sobre Base de Horas Extra (<span id="patBaseHE">150,00</span> ‚Ç¨)</h4>
      <ul>
        <li>Horas extra (23,60 %): <span id="hexPat">35,40</span> ‚Ç¨</li>
      </ul>
    </div>

    <div class="info-box" style="margin-top:20px; background:#f8d7da; border-left-color:#c92a2a;">
      <p><strong>Cuota patronal total ‚âà <span id="patTotal">513,13 ‚Ç¨</span></strong></p>
      <p><small>Suma de todas las cotizaciones empresariales</small></p>
    </div>
    
    <div class="info-box" style="margin-top:10px;">
      <strong>üíº Resumen de bases de cotizaci√≥n:</strong>
      <p>‚úÖ <strong>Base CC:</strong> Salario base + plus + prorrata mensual (SIEMPRE)</p>
      <p>‚úÖ <strong>Base CP:</strong> Base CC + horas extra</p>
      <p>‚úÖ <strong>Base HE:</strong> Solo horas extra</p>
      <p>üí∞ <strong>Base IRPF :</strong> Salario base + plus + horas extra + (paga extra completa si hay)</p>
      <p><strong>üí° Diferencia clave:</strong> 
        <br>‚Ä¢ Bases de cotizaci√≥n SIEMPRE llevan prorrata.
        <br>‚Ä¢ Base IRPF NO lleva prorrata NI dietas justificadas, pero S√ç lleva paga extra completa en meses que se cobra.
      </p>
    </div>
  </div>

  <div class="nav-buttons">
    <button onclick="nextStep(3)">‚Üê Paso anterior</button>
    <button onclick="nextStep(5)">Siguiente ‚Üí</button>
  </div>
</div>

<!-- PASO 5: BONIFICACIONES -->
<div class="step" id="step5">
  <h2>5. Bonificaciones: cuando la cuota patronal ¬´baja¬ª</h2>

  <button class="calcBtn" onclick="toggleCalc()">üìü Calculadora</button>

  <ul class="resumen">
    <li>Devengos: <span id="devRes">2.610,00 ‚Ç¨</span></li>
    <li>L√≠quido tras deducciones: <span id="liqRes">2.129,25 ‚Ç¨</span></li>
    <li>Cuota patronal sin bonificar: <span id="patRes">513,13 ‚Ç¨</span></li>
  </ul>
  <p>Bonificaci√≥n 40 % por contratar parado de larga duraci√≥n:</p>
  <p>Ahorro mensual ‚âà <span id="ahorro">205,25 ‚Ç¨</span></p>
  <div class="mini-test">
    <h4>üéØ Reto final</h4>
    <p>¬øCoste total para la empresa tras la bonificaci√≥n?</p>
    <input type="number" id="reto" placeholder="Importe"> ‚Ç¨
    <button onclick="checkReto()">Comprobar</button>
    <span id="retoOk"></span>
  </div>
  <div class="nav-buttons">
    <button onclick="nextStep(4)">‚Üê Paso anterior</button>
    <button onclick="alert('¬°Actividad completada! üéâ')">Finalizar</button>
  </div>
</div>

<!-- CALCULADORA FLOTANTE -->
<div id="calc" style="display:none; position:fixed; bottom:20px; right:20px; 
  padding:1em; border:1px solid #ccc; width:220px; background:#f8f8f8;
  border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.3); z-index:9999;">

  <input id="calcDisplay" type="text" 
    style="width:100%; margin-bottom:10px; padding:8px; text-align:right; font-size:1.1em;" 
    readonly>

  <div style="display:grid; grid-template-columns: repeat(4, 1fr); gap:5px;">
    <button onclick="press('7')">7</button>
    <button onclick="press('8')">8</button>
    <button onclick="press('9')">9</button>
    <button onclick="press('/')">√∑</button>

    <button onclick="press('4')">4</button>
    <button onclick="press('5')">5</button>
    <button onclick="press('6')">6</button>
    <button onclick="press('*')">√ó</button>

    <button onclick="press('1')">1</button>
    <button onclick="press('2')">2</button>
    <button onclick="press('3')">3</button>
    <button onclick="press('-')">‚àí</button>

    <button onclick="press('0')">0</button>
    <button onclick="press('.')">.</button>
    <button onclick="calcClear()">C</button>
    <button onclick="press('+')">+</button>

    <button onclick="calcEqual()" 
      style="grid-column: span 4; background:#007bff; color:white; padding:8px;">=</button>
  </div>
</div>

<script>
  // Variables globales para meses de pagas extras
  let mesesPagasExtras = [6, 12]; // Por defecto: junio y diciembre
  
  function toggleCalc(){
    const c=document.getElementById('calc');
    c.style.display=(c.style.display==='none')?'block':'none';
  }
  function press(v){
    document.getElementById('calcDisplay').value+=v;
  }
  function calcClear(){
    document.getElementById('calcDisplay').value='';
  }
  function calcEqual(){
    try{
      const res=eval(document.getElementById('calcDisplay').value);
      document.getElementById('calcDisplay').value=res;
    }catch{
      document.getElementById('calcDisplay').value='Error';
    }
  }

  function nextStep(n){
    document.querySelectorAll('.step').forEach(s=>s.classList.remove('active'));
    document.getElementById('step'+n).classList.add('active');
  }

  // Funci√≥n para actualizar la selecci√≥n de meses de pagas extras
  function actualizarMesesPagas() {
    const numPagas = parseInt(document.getElementById('numPagas').value) || 0;
    const container = document.getElementById('mesesPagasContainer');
    const selectDiv = document.getElementById('mesesPagasSelect');
    const infoSpan = document.getElementById('infoPagasExtras');
    
    if (numPagas > 0) {
      container.style.display = 'block';
      
      // Texto informativo
      if (numPagas === 2) {
        infoSpan.textContent = '(normalmente junio y diciembre)';
      } else {
        infoSpan.textContent = `(${numPagas} pagas al a√±o)`;
      }
      
      // Generar selects para cada paga extra
      selectDiv.innerHTML = '';
      mesesPagasExtras = [];
      
      for (let i = 1; i <= numPagas; i++) {
        const select = document.createElement('select');
        select.id = `mesPaga${i}`;
        select.onchange = recalcTodo;
        
        // Opciones de meses
        const meses = [
          {num: 1, nombre: 'Enero'},
          {num: 2, nombre: 'Febrero'},
          {num: 3, nombre: 'Marzo'},
          {num: 4, nombre: 'Abril'},
          {num: 5, nombre: 'Mayo'},
          {num: 6, nombre: 'Junio'},
          {num: 7, nombre: 'Julio'},
          {num: 8, nombre: 'Agosto'},
          {num: 9, nombre: 'Septiembre'},
          {num: 10, nombre: 'Octubre'},
          {num: 11, nombre: 'Noviembre'},
          {num: 12, nombre: 'Diciembre'}
        ];
        
        meses.forEach(mes => {
          const option = document.createElement('option');
          option.value = mes.num;
          option.textContent = mes.nombre;
          // Por defecto: primera paga en junio, segunda en diciembre
          if (numPagas === 2) {
            if (i === 1 && mes.num === 6) option.selected = true;
            if (i === 2 && mes.num === 12) option.selected = true;
          } else {
            // Para otras configuraciones, distribuir los meses
            if (i === 1 && mes.num === 6) option.selected = true;
            if (i === 2 && mes.num === 12) option.selected = true;
            if (i === 3 && mes.num === 3) option.selected = true;
            if (i === 4 && mes.num === 9) option.selected = true;
            if (i === 5 && mes.num === 1) option.selected = true;
          }
          select.appendChild(option);
        });
        
        const label = document.createElement('label');
        label.innerHTML = `Paga extra ${i}: `;
        label.style.display = 'block';
        label.style.margin = '5px 0';
        label.appendChild(select);
        selectDiv.appendChild(label);
      }
    } else {
      container.style.display = 'none';
      infoSpan.textContent = '';
    }
    
    // Guardar los meses seleccionados
    guardarMesesPagas();
  }

  function guardarMesesPagas() {
    const numPagas = parseInt(document.getElementById('numPagas').value) || 0;
    mesesPagasExtras = [];
    
    for (let i = 1; i <= numPagas; i++) {
      const select = document.getElementById(`mesPaga${i}`);
      if (select) {
        mesesPagasExtras.push(parseInt(select.value));
      }
    }
    
    // Si no hay selects (p√°gina reci√©n cargada), usar valores por defecto
    if (mesesPagasExtras.length === 0 && numPagas > 0) {
      if (numPagas === 2) {
        mesesPagasExtras = [6, 12];
      } else if (numPagas === 3) {
        mesesPagasExtras = [3, 6, 12];
      } else if (numPagas === 4) {
        mesesPagasExtras = [3, 6, 9, 12];
      } else if (numPagas === 5) {
        mesesPagasExtras = [1, 3, 6, 9, 12];
      }
    }
    
    // Ordenar meses
    mesesPagasExtras.sort((a, b) => a - b);
  }

  // Funci√≥n para formatear n√∫meros con separadores de miles y 2 decimales
  function numES(num) {
    return new Intl.NumberFormat('es-ES', {
      minimumFractionDigits: 2,
      maximumFractionDigits: 2
    }).format(num);
  }

  function recalcTodo(){
    // Obtener el mes seleccionado
    const periodo = document.getElementById('periodo').value;
    const mesActual = periodo ? parseInt(periodo.split('-')[1]) : 12;
    const anioActual = periodo ? parseInt(periodo.split('-')[0]) : 2025;
    
    // Actualizar indicador del mes
    const meses = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 
                   'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
    const indicadorMes = document.getElementById('indicadorMes');
    
    // Asegurarnos de que tenemos los meses actualizados
    guardarMesesPagas();
    
    const esMesPagaExtra = mesesPagasExtras.includes(mesActual);
    
    if (esMesPagaExtra) {
      indicadorMes.innerHTML = `<span class="mes-paga-extra">üìÖ ${meses[mesActual-1]} - Mes de paga extra</span>`;
    } else {
      indicadorMes.innerHTML = `<span>${meses[mesActual-1]}</span>`;
    }
    
    // Obtener valores de devengos
    const sal = parseFloat(document.getElementById('salBase').value) || 0;
    const plus = parseFloat(document.getElementById('plus').value) || 0;
    const hex = parseFloat(document.getElementById('hex').value) || 0;
    const dieta = parseFloat(document.getElementById('dieta').value) || 0;
    
    // Calcular prorrata de pagas extras
    const numPagas = parseInt(document.getElementById('numPagas').value) || 0;
    const conceptoPagas = document.querySelector('input[name="conceptoPagas"]:checked').value;
    
    let basePagasExtra = 0;
    if (numPagas > 0) {
      if (conceptoPagas === 'salarioBase') {
        basePagasExtra = sal;
      } else if (conceptoPagas === 'salarioBasePlus') {
        basePagasExtra = sal + plus;
      }
    }
    
    const prorrataMensualPagas = (basePagasExtra * numPagas) / 12;
    document.getElementById('prorrataPagas').textContent = numES(prorrataMensualPagas);
    
    // Verificar si es mes de paga extra
    const pagaExtraActualInfo = document.getElementById('pagaExtraActualInfo');
    
    let pagaExtraEsteMes = 0;
    if (esMesPagaExtra && numPagas > 0) {
      pagaExtraEsteMes = basePagasExtra;
      pagaExtraActualInfo.style.display = 'block';
      document.getElementById('importePagaExtraActual').textContent = numES(pagaExtraEsteMes);
    } else {
      pagaExtraActualInfo.style.display = 'none';
    }
    
    // ¬°¬°¬°CORRECCI√ìN DEFINITIVA!!!
    // 1. Bases de cotizaci√≥n: SIEMPRE incluyen prorrata mensual
    const baseCC = sal + plus + prorrataMensualPagas; // SIEMPRE con prorrata
    
    // 2. Base de Contingencias Profesionales: Base CC + horas extra
    const baseCP = baseCC + hex; // Tambi√©n SIEMPRE con prorrata (a trav√©s de Base CC)
    
    // 3. Base de Horas Extra: solo horas extra
    const baseHE = hex;
    
    // 4. Base para IRPF: NO incluye prorrata NI dietas justificadas, pero S√ç incluye paga extra completa si se cobra
    const baseIRPF = sal + plus + hex + pagaExtraEsteMes; // ¬°NO dietas justificadas!
    
    // Mostrar bases de cotizaci√≥n
    document.getElementById('baseCC').textContent = numES(baseCC);
    document.getElementById('baseCP').textContent = numES(baseCP);
    document.getElementById('baseHE').textContent = numES(baseHE);
    document.getElementById('baseIRPF').textContent = numES(baseIRPF);
    
    // Actualizar valores en las explicaciones de deducciones
    document.getElementById('baseCCVal').textContent = numES(baseCC);
    document.getElementById('baseCCValCC').textContent = numES(baseCC);
    document.getElementById('baseCCValMEI').textContent = numES(baseCC);
    document.getElementById('baseCPVal').textContent = numES(baseCP);
    document.getElementById('baseCPValParo').textContent = numES(baseCP);
    document.getElementById('baseCPValFP').textContent = numES(baseCP);
    document.getElementById('baseHEVal').textContent = numES(baseHE);
    document.getElementById('baseHEValHex').textContent = numES(baseHE);
    document.getElementById('baseIRPFVal').textContent = numES(baseIRPF);
    document.getElementById('baseIRPFValCalc').textContent = numES(baseIRPF);
    
    // Calcular devengos totales (incluyendo paga extra si corresponde)
    const devengos = sal + plus + hex + dieta + pagaExtraEsteMes;
    const salarial = sal + plus + hex + pagaExtraEsteMes;
    document.getElementById('totDev').textContent = numES(devengos);
    
    // Actualizar mini-reto
    generarOpciones(salarial, devengos);
    
    // CALCULAR DEDUCCIONES DEL TRABAJADOR - SEG√öN BASE CORRECTA
    // Sobre Base de Contingencias Comunes:
    const cc = baseCC * 0.047; // 4.70% sobre base CC
    const mei = baseCC * 0.0013; // 0.13% sobre base CC
    
    // Sobre Base de Contingencias Profesionales:
    const paro = baseCP * 0.0155; // 1.55% sobre base CP
    const fp = baseCP * 0.001; // 0.10% sobre base CP
    
    // Sobre Base de Horas Extra:
    const hexDed = baseHE * 0.047; // 4.70% sobre base horas extra
    
    // IRPF sobre Base IRPF (¬°NO incluye prorrata NI dietas, pero S√ç paga extra si corresponde!)
    const irpf = baseIRPF * 0.11; // 11% sobre base IRPF
    
    const ant = parseFloat(document.getElementById('ant').value) || 0;
    
    const totalDed = cc + mei + paro + fp + hexDed + irpf + ant;
    
    // Actualizar deducciones
    document.getElementById('cc').value = numES(cc);
    document.getElementById('mei').value = numES(mei);
    document.getElementById('paro').value = numES(paro);
    document.getElementById('fp').value = numES(fp);
    document.getElementById('hexDed').value = numES(hexDed);
    document.getElementById('irpf').value = numES(irpf);
    document.getElementById('totalDed').textContent = numES(totalDed);
    
    // Calcular l√≠quido
    const liquido = devengos - totalDed;
    document.getElementById('liq').textContent = numES(liquido);
    document.getElementById('liqRes').textContent = numES(liquido);
    
    // Actualizar texto con par√©ntesis
    document.getElementById('txtDev').textContent = numES(devengos);
    document.getElementById('txtDed').textContent = numES(totalDed);
    
    // CALCULAR CUOTA PATRONAL - SEG√öN BASE CORRECTA
    // Sobre Base de Contingencias Comunes:
    const patCC = baseCC * 0.236; // 23.60% sobre base CC
    const patMEI = baseCC * 0.0067; // 0.67% sobre base CC
    
    // Sobre Base de Contingencias Profesionales:
    const patParo = baseCP * 0.055; // 5.50% sobre base CP
    const patFP = baseCP * 0.006; // 0.60% sobre base CP
    const patFog = baseCP * 0.002; // 0.20% sobre base CP
    const patAT = baseCP * 0.026; // 2.60% sobre base CP (CNAE 1411)
    
    // Sobre Base de Horas Extra:
    const patHE = baseHE * 0.236; // 23.60% sobre base horas extra
    
    const patTotal = patCC + patMEI + patParo + patFP + patFog + patAT + patHE;
    
    // Actualizar cuota patronal
    document.getElementById('patBaseCC').textContent = numES(baseCC);
    document.getElementById('patBaseCP').textContent = numES(baseCP);
    document.getElementById('patBaseHE').textContent = numES(baseHE);
    
    document.getElementById('ccPat').textContent = numES(patCC);
    document.getElementById('meiPat').textContent = numES(patMEI);
    document.getElementById('paroPat').textContent = numES(patParo);
    document.getElementById('fpPat').textContent = numES(patFP);
    document.getElementById('fogasaPat').textContent = numES(patFog);
    document.getElementById('atPat').textContent = numES(patAT);
    document.getElementById('hexPat').textContent = numES(patHE);
    document.getElementById('patTotal').textContent = numES(patTotal);
    
    // Actualizar resumen paso 5
    document.getElementById('devRes').textContent = numES(devengos);
    document.getElementById('patRes').textContent = numES(patTotal);
    document.getElementById('ahorro').textContent = numES(patTotal * 0.4);
  }

  function generarOpciones(salarial, devengos){
    const sb = parseFloat(document.getElementById('salBase').value) || 0;
    const plus = parseFloat(document.getElementById('plus').value) || 0;
    const hex = parseFloat(document.getElementById('hex').value) || 0;
    const dieta = parseFloat(document.getElementById('dieta').value) || 0;
    
    const ops = [
      {val: sb + hex, text: numES(sb + hex) + ' ‚Ç¨'},
      {val: plus + sb, text: numES(plus + sb) + ' ‚Ç¨'},
      {val: devengos, text: numES(devengos) + ' ‚Ç¨'},
      {val: salarial, text: numES(salarial) + ' ‚Ç¨'}
    ];
    
    // Mezclar las opciones
    for (let i = ops.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [ops[i], ops[j]] = [ops[j], ops[i]];
    }
    
    // Mostrar las opciones
    const opcionesDiv = document.getElementById('opcionesReto');
    opcionesDiv.innerHTML = '';
    
    ops.forEach((op, index) => {
      const label = document.createElement('label');
      label.className = 'opcion';
      
      const radio = document.createElement('input');
      radio.type = 'radio';
      radio.name = 'opcionDev';
      radio.value = op.val;
      radio.id = 'op' + index;
      
      label.appendChild(radio);
      label.appendChild(document.createTextNode(' ' + op.text));
      opcionesDiv.appendChild(label);
    });
  }

  function checkDev() {
    const sb = parseFloat(document.getElementById('salBase').value) || 0;
    const plus = parseFloat(document.getElementById('plus').value) || 0;
    const hex = parseFloat(document.getElementById('hex').value) || 0;
    const dieta = parseFloat(document.getElementById('dieta').value) || 0;
    
    // Obtener el mes seleccionado
    const periodo = document.getElementById('periodo').value;
    const mesActual = periodo ? parseInt(periodo.split('-')[1]) : 12;
    const esMesPagaExtra = mesesPagasExtras.includes(mesActual);
    
    // Calcular paga extra si corresponde
    const numPagas = parseInt(document.getElementById('numPagas').value) || 0;
    const conceptoPagas = document.querySelector('input[name="conceptoPagas"]:checked').value;
    
    let pagaExtraEsteMes = 0;
    if (esMesPagaExtra && numPagas > 0) {
      if (conceptoPagas === 'salarioBase') {
        pagaExtraEsteMes = sb;
      } else if (conceptoPagas === 'salarioBasePlus') {
        pagaExtraEsteMes = sb + plus;
      }
    }
    
    const salarial = sb + plus + hex + pagaExtraEsteMes;
    
    const selected = document.querySelector('input[name="opcionDev"]:checked');
    const resultSpan = document.getElementById('devOk');
    
    if (!selected) {
      resultSpan.innerHTML = '<span style="color:red;">Selecciona una opci√≥n</span>';
      return;
    }
    
    const selectedValue = parseFloat(selected.value);
    
    if (Math.abs(selectedValue - salarial) < 0.01) {
      resultSpan.innerHTML = '<span style="color:green;">‚úÖ ¬°Correcto! El salario es ' + numES(salarial) + ' ‚Ç¨ (excluye dietas justificadas)</span>';
    } else {
      resultSpan.innerHTML = '<span style="color:red;">‚ùå Incorrecto. El salario es ' + numES(salarial) + ' ‚Ç¨ (salario base + plus + horas extra + paga extra si corresponde)</span>';
    }
  }

function checkReto() {
  const dev = parseFloat(document.getElementById("devRes").textContent.replace(" ‚Ç¨","").replace(".","").replace(",","."));
  const pat = parseFloat(document.getElementById("patRes").textContent.replace(" ‚Ç¨","").replace(".","").replace(",","."));
  const ahorro = parseFloat(document.getElementById("ahorro").textContent.replace(" ‚Ç¨","").replace(".","").replace(",","."));

  const correcto = dev + pat - ahorro;

  const valorUsuario = parseFloat(document.getElementById("reto").value);

  if (Math.abs(valorUsuario - correcto) < 0.5) {
    document.getElementById("retoOk").textContent = "‚úîÔ∏è Correcto";
    document.getElementById("retoOk").style.color = "green";
  } else {
    document.getElementById("retoOk").textContent = "‚ùå Incorrecto. Intenta de nuevo.";
    document.getElementById("retoOk").style.color = "red";
  }
}

  // Inicializar la p√°gina
  window.onload = function() {
    actualizarMesesPagas();
    recalcTodo();
  };
</script>
</body>
</html>
